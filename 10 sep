import React from "react";
import { render, fireEvent } from "@testing-library/react";
import * as ReactRedux from "react-redux";
import Index from "./index";

describe("Index page", () => {
  it("should dispatch correct action when Accept is clicked", () => {
    const mockDispatch = jest.fn();

    // ðŸ‘‡ Spy only on useDispatch, leave everything else alone
    jest.spyOn(ReactRedux, "useDispatch").mockReturnValue(mockDispatch);

    const { getByText } = render(<Index />);

    // find the button by text (no testid needed)
    const acceptButton = getByText(/accept/i);

    fireEvent.click(acceptButton);

    // âœ… Now assert dispatch received the right payload
    expect(mockDispatch).toHaveBeenCalledWith(
      expect.objectContaining({
        payload: expect.objectContaining({
          cifId: expect.any(String),
          tncId: expect.anything(),
          tncVersion: expect.anything(),
          isAccepted: true,
          ipAddress: expect.any(String),
        }),
      })
    );
  });
});
